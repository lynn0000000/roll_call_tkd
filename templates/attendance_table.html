<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<title>è™å˜¯è·†æ‹³é“é¤¨ - é«˜è³ªæ„Ÿé»åè¡¨</title>
<style>
body {
    font-family: "Microsoft JhengHei", sans-serif;
    background: #2E2E2E;
    color: #EEE;
    margin: 0;
    padding: 40px;
}
h1 {
    text-align: center;
    font-size: 3em;
    margin-bottom: 20px;
    position: relative;
}
h1::before {
    content: "ğŸ¯";
    position: absolute;
    left: -50px;
    top: 0;
    font-size: 2.5em;
}
table {

    width: 100%;
    border-collapse: collapse;
    background-color: #3C3C3C;
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
    margin-bottom: 20px;
}
th, td {
    border: 1px solid #555;
    padding: 12px;
    text-align: center;
}
th {
    background-color: #1C1C1C;
    color: #FFA500;
    font-size: 1.1em;
}
tr:nth-child(even) td { background-color: #2A2A2A; }
tr:hover td { background-color: #444; }

.slot-checkbox {
    transform: scale(1.3);
    accent-color: #FFA500;
    cursor: pointer;
}

#submitBtn {
    display: block;
    margin: 0 auto;
    padding: 12px 28px;
    font-size: 1.2em;
    border: none;
    border-radius: 8px;
    background: #FFA500;
    color: #1C1C1C;
    font-weight: bold;
    cursor: pointer;
    transition: 0.2s;
}
#submitBtn:hover { background: #FFB733; }
#result { text-align: center; font-size: 1.2em; font-weight: bold; margin-top: 15px; }
</style>
</head>
<body>
<h1>è™å˜¯è·†æ‹³é“é¤¨ - é»åè¡¨</h1>

<table>
  <thead>
    <tr>
      <th>å­¸ç”Ÿå§“å</th>
      {% for weekday in [2,3,4,5,6] %}
        <th colspan="3">{{ dates[weekday] }}</th>
      {% endfor %}
    </tr>
    <tr>
      <th></th>
      {% for weekday in [2,3,4,5,6] %}
        <th>A</th><th>B</th><th>C</th>
      {% endfor %}
    </tr>
    <tr>
      <th></th>
      {% for weekday in [2,3,4,5,6] %}
        <th>W{{ weekday }}</th><th>W{{ weekday }}</th><th>W{{ weekday }}</th>
      {% endfor %}
    </tr>
  </thead>
  <tbody>
    {% for student in students %}
      <tr>
        <td>{{ student.name }}</td>
        {% for weekday in [2,3,4,5,6] %}
          {% for slot in slots if slot.weekday==weekday %}
            <td>
              <input type="checkbox" class="slot-checkbox"
                     data-student-id="{{ student.id }}"
                     data-slot-id="{{ slot.id }}">
            </td>
          {% endfor %}
        {% endfor %}
      </tr>
    {% endfor %}
  </tbody>
</table>

<button id="submitBtn">é€å‡ºé»å</button>
<p id="result"></p>

<script>
const submitBtn = document.getElementById('submitBtn');
const result = document.getElementById('result');

submitBtn.addEventListener('click', async () => {
    const checkboxes = document.querySelectorAll('.slot-checkbox');
    let successCount = 0;

    for (const cb of checkboxes) {
        if(cb.checked){
            const data = {
                student_id: cb.dataset.studentId,
                slot_id: cb.dataset.slotId,
                attend_date: new Date().toISOString().slice(0,10)
            };
            try{
                const res = await fetch('/attendance', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const resData = await res.json();
                if(resData.success) successCount++;
            }catch(err){ console.error(err); }
        }
    }

    result.textContent = `å®Œæˆé»åï¼Œç¸½å…±æˆåŠŸ ${successCount} ç­†`;
    result.style.color = "#FFA500";
});
</script>
</body>
</html>
